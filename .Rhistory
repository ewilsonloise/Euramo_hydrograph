trg_h <- trg_h %>%
pivot_wider(
names_from = varname,
values_from = c(site, height_metres_value, height_deriv_value, height_metres_quality),
names_glue = "TRG_{.value}"
) %>%
select(-var)
# Tully River at Tully Gorge National Park Rainfall data
trg_r <- read_csv("Data/Raw/113015A.R.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(rainfall_mm_value = value) %>%
rename(rainfall_mm_quality = quality)
trg_r <- trg_r %>%
pivot_wider(
names_from = varname,
values_from = c(rainfall_mm_value, rainfall_mm_quality, site),
names_glue = "TRG_{.value}"
) %>%
select(-var)
# Tully River at Tully Gorge National Park Discharge data
trg_d <- read_csv("Data/Raw/113015A.Q.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(discharge_cumecs_value = value) %>%
rename(discharge_cumecs_quality = quality)
trg_d <- trg_d %>%
pivot_wider(
names_from = varname,
values_from = c(discharge_cumecs_value, discharge_cumecs_quality, site),
names_glue = "TRG_{.value}"
) %>%
select(-var)
trg_dat <- left_join(trg_h, trg_d, trg_r, by = c("TRG_site" = "TRG_site", "time" = "time"))
# ------------------------------------------------------------
# 114001A Murray River at Upper Murray
# Murray River at Upper Murray Rainfall data
mru_r <- read_csv("Data/Raw/114001A.R.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(rainfall_mm_value = value) %>%
rename(rainfall_mm_quality = quality)
mru_r <- mru_r %>%
pivot_wider(
names_from = varname,
values_from = c(rainfall_mm_value, rainfall_mm_quality, site),
names_glue = "MRU_{.value}"
) %>%
select(-var)
dat1 <- left_join(trg_dat, tre_dat, by = c("time" = "time"))
dat <- left_join(dat1, mru_r, by = c("time" = "time"))
library(visdat)
vis_miss
vis_miss(dat)
vis_miss(dat, warn_large_data = FALSE)
View(trg_h)
# Cochable_Creek height data
cc_h <- read_csv("Data/Raw/113004A.H.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(height_metres_value = value) %>%
rename(height_metres_quality = quality)%>%
arrange(site, time) %>%
mutate(height_deriv_value = height_metres_value - lag(height_metres_value))
cc_h <- cc_h %>%
pivot_wider(
names_from = varname,
values_from = c(site, height_metres_value, height_deriv_value, height_metres_quality),
names_glue = "CC_{.value}"
) %>%
select(-var)
# Cochable_Creek discharge data
cc_d <- read_csv("Data/Raw/113004A.Q.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(discharge_cumecs_value = value) %>%
rename(discharge_cumecs_quality = quality)
cc_d <- cc_d %>%
pivot_wider(
names_from = varname,
values_from = c(discharge_cumecs_value, discharge_cumecs_quality, site),
names_glue = "CC_{.value}"
) %>%
select(-var)
cc_dat <- left_join(cc_h, cc_d, by = c("CC_site" = "CC_site", "time" = "time"))
# Data Wrangle
# Libraries
library(tidyverse)
library(lubridate)
library(dplyr)
library(readr)
# -----------------------------------------------------------
# 113004A Cochable Creek at Powerline
# Cochable_Creek height data
cc_h <- read_csv("Data/Raw/113004A.H.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(height_metres_value = value) %>%
rename(height_metres_quality = quality)%>%
arrange(site, time) %>%
mutate(height_deriv_value = height_metres_value - lag(height_metres_value))
cc_h <- cc_h %>%
pivot_wider(
names_from = varname,
values_from = c(site, height_metres_value, height_deriv_value, height_metres_quality),
names_glue = "CC_{.value}"
) %>%
select(-var)
# Cochable_Creek discharge data
cc_d <- read_csv("Data/Raw/113004A.Q.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(discharge_cumecs_value = value) %>%
rename(discharge_cumecs_quality = quality)
cc_d <- cc_d %>%
pivot_wider(
names_from = varname,
values_from = c(discharge_cumecs_value, discharge_cumecs_quality, site),
names_glue = "CC_{.value}"
) %>%
select(-var)
cc_dat <- left_join(cc_h, cc_d, by = c("CC_site" = "CC_site", "time" = "time"))
# --------------------------------------------------------------
# 113006A Tully River at Euramo
# Tully River at Euramo Rainfall data
tre_r <- read_csv("Data/Raw/113006A.R.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(rainfall_mm_value = value) %>%
rename(rainfall_mm_quality = quality)
tre_r <- tre_r %>%
pivot_wider(
names_from = varname,
values_from = c(rainfall_mm_value, rainfall_mm_quality, site),
names_glue = "TRE_{.value}"
) %>%
select(-var)
# Tully River at Euramo Height data
tre_h <- read_csv("Data/Raw/113006A.H.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(height_metres_value = value,
height_metres_quality = quality) %>%
arrange(site, time) %>%
mutate(height_deriv_value = height_metres_value - lag(height_metres_value)) %>%
pivot_wider(
names_from = varname,
values_from = c(site, height_metres_value, height_deriv_value, height_metres_quality),
names_glue = "TRE_{.value}"
) %>%
select(-var)
# Tully River at Euramo Discharge data
tre_d <- read_csv("Data/Raw/113006A.Q.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(discharge_cumecs_value = value) %>%
rename(discharge_cumecs_quality = quality)
tre_d <- tre_d %>%
pivot_wider(
names_from = varname,
values_from = c(discharge_cumecs_value, discharge_cumecs_quality, site),
names_glue = "TRE_{.value}"
) %>%
select(-var)
tre_dat <- left_join(tre_h, tre_d, tre_r, by = c("TRE_site" = "TRE_site", "time" = "time"))
# ---------------------------------------------------
# 113015A Tully River at Tully Gorge National Park
# Tully River at Tully Gorge National Park Height data
trg_h <- read_csv("Data/Raw/113015A.H.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(height_metres_value = value) %>%
rename(height_metres_quality = quality)%>%
arrange(site, time) %>%
mutate(height_deriv_value = height_metres_value - lag(height_metres_value))
trg_h <- trg_h %>%
pivot_wider(
names_from = varname,
values_from = c(site, height_metres_value, height_deriv_value, height_metres_quality),
names_glue = "TRG_{.value}"
) %>%
select(-var)
# Tully River at Tully Gorge National Park Rainfall data
trg_r <- read_csv("Data/Raw/113015A.R.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(rainfall_mm_value = value) %>%
rename(rainfall_mm_quality = quality)
trg_r <- trg_r %>%
pivot_wider(
names_from = varname,
values_from = c(rainfall_mm_value, rainfall_mm_quality, site),
names_glue = "TRG_{.value}"
) %>%
select(-var)
# Tully River at Tully Gorge National Park Discharge data
trg_d <- read_csv("Data/Raw/113015A.Q.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(discharge_cumecs_value = value) %>%
rename(discharge_cumecs_quality = quality)
trg_d <- trg_d %>%
pivot_wider(
names_from = varname,
values_from = c(discharge_cumecs_value, discharge_cumecs_quality, site),
names_glue = "TRG_{.value}"
) %>%
select(-var)
trg_dat <- left_join(trg_h, trg_d, trg_r, by = c("TRG_site" = "TRG_site", "time" = "time"))
# ------------------------------------------------------------
# 114001A Murray River at Upper Murray
# Murray River at Upper Murray Rainfall data
mru_r <- read_csv("Data/Raw/114001A.R.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(rainfall_mm_value = value) %>%
rename(rainfall_mm_quality = quality)
mru_r <- mru_r %>%
pivot_wider(
names_from = varname,
values_from = c(rainfall_mm_value, rainfall_mm_quality, site),
names_glue = "MRU_{.value}"
) %>%
select(-var)
# ---------------------------------------------------------------
dat1 <- left_join(trg_dat, tre_dat, by = c("time" = "time"))
dat2 <- left_join(cc_dat, mru_r, by = c("time" = "time"))
dat <- left_join(dat1, dat2, by = c("time" = "time"))
vis_miss(dat, warn_large_data = FALSE)
dat_na <- na.omit(dat)
vis_miss(dat_na, warn_large_data = FALSE) #note only 3 cells have NAa, but they need to be removed
write_csv(dat, "Data/dat.csv")
tibble(dat)
View(trg_dat)
trg_dat <- left_join(trg_h, trg_r, by = c("TRG_site" = "TRG_site", "time" = "time"))
tre_dat <- left_join(tre_h, tre_d, by = c("TRE_site" = "TRE_site", "time" = "time"))
tre_dat <- left_join(tre_dat, tre_r, by = c("TRE_site" = "TRE_site", "time" = "time"))
View(tre_dat)
# Data Wrangle
# Libraries
library(tidyverse)
library(lubridate)
library(dplyr)
library(readr)
# -----------------------------------------------------------
# 113004A Cochable Creek at Powerline
# Cochable_Creek height data
cc_h <- read_csv("Data/Raw/113004A.H.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(height_metres_value = value) %>%
rename(height_metres_quality = quality)%>%
arrange(site, time) %>%
mutate(height_deriv_value = height_metres_value - lag(height_metres_value))
cc_h <- cc_h %>%
pivot_wider(
names_from = varname,
values_from = c(site, height_metres_value, height_deriv_value, height_metres_quality),
names_glue = "CC_{.value}"
) %>%
select(-var)
# Cochable_Creek discharge data
cc_d <- read_csv("Data/Raw/113004A.Q.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(discharge_cumecs_value = value) %>%
rename(discharge_cumecs_quality = quality)
cc_d <- cc_d %>%
pivot_wider(
names_from = varname,
values_from = c(discharge_cumecs_value, discharge_cumecs_quality, site),
names_glue = "CC_{.value}"
) %>%
select(-var)
cc_dat <- left_join(cc_h, cc_d, by = c("CC_site" = "CC_site", "time" = "time"))
# --------------------------------------------------------------
# 113006A Tully River at Euramo
# Tully River at Euramo Rainfall data
tre_r <- read_csv("Data/Raw/113006A.R.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(rainfall_mm_value = value) %>%
rename(rainfall_mm_quality = quality)
tre_r <- tre_r %>%
pivot_wider(
names_from = varname,
values_from = c(rainfall_mm_value, rainfall_mm_quality, site),
names_glue = "TRE_{.value}"
) %>%
select(-var)
# Tully River at Euramo Height data
tre_h <- read_csv("Data/Raw/113006A.H.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(height_metres_value = value,
height_metres_quality = quality) %>%
arrange(site, time) %>%
mutate(height_deriv_value = height_metres_value - lag(height_metres_value)) %>%
pivot_wider(
names_from = varname,
values_from = c(site, height_metres_value, height_deriv_value, height_metres_quality),
names_glue = "TRE_{.value}"
) %>%
select(-var)
# Tully River at Euramo Discharge data
tre_d <- read_csv("Data/Raw/113006A.Q.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(discharge_cumecs_value = value) %>%
rename(discharge_cumecs_quality = quality)
tre_d <- tre_d %>%
pivot_wider(
names_from = varname,
values_from = c(discharge_cumecs_value, discharge_cumecs_quality, site),
names_glue = "TRE_{.value}"
) %>%
select(-var)
tre_dat <- left_join(tre_h, tre_d, by = c("TRE_site" = "TRE_site", "time" = "time"))
tre_dat <- left_join(tre_dat, tre_r, by = c("TRE_site" = "TRE_site", "time" = "time"))
# ---------------------------------------------------
# 113015A Tully River at Tully Gorge National Park
# Tully River at Tully Gorge National Park Height data
trg_h <- read_csv("Data/Raw/113015A.H.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(height_metres_value = value) %>%
rename(height_metres_quality = quality)%>%
arrange(site, time) %>%
mutate(height_deriv_value = height_metres_value - lag(height_metres_value))
trg_h <- trg_h %>%
pivot_wider(
names_from = varname,
values_from = c(site, height_metres_value, height_deriv_value, height_metres_quality),
names_glue = "TRG_{.value}"
) %>%
select(-var)
# Tully River at Tully Gorge National Park Rainfall data
trg_r <- read_csv("Data/Raw/113015A.R.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(rainfall_mm_value = value) %>%
rename(rainfall_mm_quality = quality)
trg_r <- trg_r %>%
pivot_wider(
names_from = varname,
values_from = c(rainfall_mm_value, rainfall_mm_quality, site),
names_glue = "TRG_{.value}"
) %>%
select(-var)
# Tully River at Tully Gorge National Park Discharge data
trg_d <- read_csv("Data/Raw/113015A.Q.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(discharge_cumecs_value = value) %>%
rename(discharge_cumecs_quality = quality)
trg_d <- trg_d %>%
pivot_wider(
names_from = varname,
values_from = c(discharge_cumecs_value, discharge_cumecs_quality, site),
names_glue = "TRG_{.value}"
) %>%
select(-var)
trg_dat <- left_join(trg_h, trg_d, by = c("TRG_site" = "TRG_site", "time" = "time"))
trg_dat <- left_join(trg_dat, trg_r, by = c("TRG_site" = "TRG_site", "time" = "time"))
# ------------------------------------------------------------
# 114001A Murray River at Upper Murray
# Murray River at Upper Murray Rainfall data
mru_r <- read_csv("Data/Raw/114001A.R.CSV") %>%
mutate(time = format(time, "%Y-%m-%d %H")) %>%
rename(rainfall_mm_value = value) %>%
rename(rainfall_mm_quality = quality)
mru_r <- mru_r %>%
pivot_wider(
names_from = varname,
values_from = c(rainfall_mm_value, rainfall_mm_quality, site),
names_glue = "MRU_{.value}"
) %>%
select(-var)
# ---------------------------------------------------------------
dat1 <- left_join(trg_dat, tre_dat, by = c("time" = "time"))
dat2 <- left_join(cc_dat, mru_r, by = c("time" = "time"))
dat <- left_join(dat1, dat2, by = c("time" = "time"))
# vis_miss(dat, warn_large_data = FALSE) #note only 3 cells have NAa, but they need to be removed
dat_na <- na.omit(dat) #remove the three rows with NA values
# vis_miss(dat_na, warn_large_data = FALSE) # data is 100% present
write_csv(dat, "Data/dat.csv")
dat_lag <- dat %>%  select(c(time, TRE_height_metres_value, TRG_rainfall_mm_value))
tibble(dat_lag)
dat_lag <- dat_lag %>%
mutate(
rain = TRG_rainfall_mm_value,
height = TRE_height_metres_value
)
model <- lm(height ~ rain, data = dat_lag)
plot(model)
dat_lag <- dat_lag %>%
mutate(
rain = TRG_rainfall_mm_value,
height = TRE_height_metres_value
)
library(tidyverse)
library(lubridate)
library(dplyr)
library(readr)
dat_lag <- dat %>%  select(c(time, TRE_height_metres_value, TRG_rainfall_mm_value))
dat_lag <- dat_lag %>%
mutate(
rain = TRG_rainfall_mm_value,
height = TRE_height_metres_value
)
model <- lm(height ~ rain, data = dat_lag)
plot(model)
library(shiny)
library(ggplot2)
library(dplyr)
library(lubridate)
library(shiny)
library(shiny)
library(ggplot2)
library(dplyr)
library(lubridate)
# Sample data frame 'dat_lag' (your actual data will be loaded instead)
dat_lag <- tibble(
time = seq(ymd_h("2008-11-01 00"), by = "hour", length.out = 100),
TRE_height_metres_value = c(rep(1.91, 10), runif(90, 1.9, 2.1)),
TRG_rainfall_mm_value = c(rep(0, 10), runif(90, 0, 5))
)
# UI
ui <- fluidPage(
titlePanel("Rainfall vs Height with Lag"),
sidebarLayout(
sidebarPanel(
sliderInput("lag", "Lag (hours):", min = 1, max = 24, value = 3),
actionButton("update", "Update Model")
),
mainPanel(
plotOutput("plot"),
verbatimTextOutput("model_summary")
)
)
)
# Server
server <- function(input, output, session) {
# Reactive expression to calculate shifted rainfall based on selected lag
reactive_data <- reactive({
dat_lag %>%
mutate(rain_shifted = lag(TRG_rainfall_mm_value, n = input$lag))
})
# Render the plot of Rainfall vs Height with the model
output$plot <- renderPlot({
data <- reactive_data()
# Fit the linear model
model <- lm(TRE_height_metres_value ~ rain_shifted, data = data)
# Plot the data and regression line
ggplot(data, aes(x = rain_shifted, y = TRE_height_metres_value)) +
geom_point() +
geom_smooth(method = "lm", se = TRUE, color = "blue") +
labs(title = paste("Lag Time:", input$lag, "hours"),
x = "Rainfall (mm) at t-lag", y = "Height (m)")
})
# Show the model summary
output$model_summary <- renderPrint({
data <- reactive_data()
# Fit the linear model
model <- lm(TRE_height_metres_value ~ rain_shifted, data = data)
# Return model summary
summary(model)
})
}
# Run the application
shinyApp(ui = ui, server = server)
# Sample data frame 'dat_lag' (your actual data will be loaded instead)
dat_lag
dat_lag <- dat %>%  select(c(time, TRE_height_metres_value, TRG_rainfall_mm_value))
dat_lag <- dat_lag %>%
mutate(
rain = TRG_rainfall_mm_value,
height = TRE_height_metres_value
)
# Sample data frame 'dat_lag' (your actual data will be loaded instead)
dat_lag
dat_lag <- dat %>%  select(c(time, TRE_height_metres_value, TRG_rainfall_mm_value))
# Sample data frame 'dat_lag' (your actual data will be loaded instead)
dat_lag
library(shiny)
library(ggplot2)
library(dplyr)
library(lubridate)
# Sample data frame 'dat_lag' (your actual data will be loaded instead)
# dat_lag
# UI
ui <- fluidPage(
titlePanel("Rainfall vs Height with Lag"),
sidebarLayout(
sidebarPanel(
sliderInput("lag", "Lag (hours):", min = 1, max = 24, value = 3),
actionButton("update", "Update Model")
),
mainPanel(
plotOutput("plot"),
verbatimTextOutput("model_summary")
)
)
)
# Server
server <- function(input, output, session) {
# Reactive expression to calculate shifted rainfall based on selected lag
reactive_data <- reactive({
dat_lag %>%
mutate(rain_shifted = lag(TRG_rainfall_mm_value, n = input$lag))
})
# Render the plot of Rainfall vs Height with the model
output$plot <- renderPlot({
data <- reactive_data()
# Fit the linear model
model <- lm(TRE_height_metres_value ~ rain_shifted, data = data)
# Plot the data and regression line
ggplot(data, aes(x = rain_shifted, y = TRE_height_metres_value)) +
geom_point() +
geom_smooth(method = "lm", se = TRUE, color = "blue") +
labs(title = paste("Lag Time:", input$lag, "hours"),
x = "Rainfall (mm) at t-lag", y = "Height (m)")
})
# Show the model summary
output$model_summary <- renderPrint({
data <- reactive_data()
# Fit the linear model
model <- lm(TRE_height_metres_value ~ rain_shifted, data = data)
# Return model summary
summary(model)
})
}
# Run the application
shinyApp(ui = ui, server = server)
